{% extends 'base.html.twig' %}

{% block title %}Sysadmin Overview{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">üõ†Ô∏è System Overview (last 24h)</h1>

    <div class="row">
        <div class="col-md-4">
            <div class="card border-primary mb-3">
                <div class="card-header">Traffic</div>
                <div class="card-body">
                    <p>Total Requests: <strong>{{ data.total }}</strong></p>
                    <p>Unique Visitors: <strong>{{ data.unique }}</strong></p>
                    <p>Bots: <strong>{{ data.bots }}</strong></p>
                    <p>Authenticated: <strong>{{ data.auth_counts.auth }}</strong></p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-info mb-3">
                <div class="card-header">Performance</div>
                <div class="card-body">
                    <p>Avg Duration: {{ data.avg_duration_ms }} ms</p>
                    <p>Max Duration: {{ data.max_duration_ms }} ms</p>
                    <p>Avg Memory: {{ data.avg_memory_mb }} MB</p>
                    <p>Max Memory: {{ data.max_memory_mb }} MB</p>
                    <p>Avg Payload: {{ data.avg_response_kb }} KB</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-warning mb-3">
                <div class="card-header">PHP Warnings</div>
                <div class="card-body">
                    {% for type, count in data.php_warnings %}
                        <p>{{ type|capitalize }}: <strong>{{ count }}</strong></p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <h3 class="mt-5">üêå Slow Routes</h3>
    <table class="table table-sm table-striped">
        <thead>
            <tr><th>Route</th><th>Requests</th><th>Avg Duration</th><th>Max Duration</th></tr>
        </thead>
        <tbody>
            {% for route, durations in data.byRouteDuration|slice(0, 5) %}
                <tr>
                    <td>{{ route }}</td>
                    <td>{{ data.byRoute[route] }}</td>
                    <td>{{ durations|average|round(1) }} ms</td>
                    <td>{{ durations|max|round(1) }} ms</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3 class="mt-4">üìõ Top Status Codes</h3>
    <table class="table table-sm table-bordered w-auto">
        <tr>
            {% for code, count in data.byStatusCode %}
                <th>{{ code }}</th>
            {% endfor %}
        </tr>
        <tr>
            {% for code, count in data.byStatusCode %}
                <td>{{ count }}</td>
            {% endfor %}
        </tr>
    </table>
</div>
{% endblock %}

